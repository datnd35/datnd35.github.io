---
layout: post
title: "WebView"
categories: misc
---

### Webview lÃ  gÃ¬?

- Hiá»ƒu má»™t cÃ¡ch Ä‘Æ¡n giáº£n thÃ¬ Webview lÃ  má»™t Ä‘á»‘i tÆ°á»£ng view trong Android cho phÃ©p láº­p trÃ¬nh viÃªn cÃ³ thá»ƒ hiá»ƒn thá»‹ ná»™i dung cá»§a má»™t Website vÃ o trong á»©ng dá»¥ng cá»§a mÃ¬nh thÃ´ng qua 1 Ä‘Æ°á»ng dáº«n hoáº·c báº¡n cÃ³ thá»ƒ Ä‘á»‹nh nghÄ©a 1 file HTML trong project cá»§a báº¡n vÃ  sá»­ dá»¥ng Webview Ä‘á»ƒ Ä‘á»c file Ä‘Ã³. NÃ³i 1 cÃ¡ch Ä‘Æ¡n giáº£n hÆ¡n thÃ¬ Webview giÃºp biáº¿n á»©ng dá»¥ng cá»§a báº¡n trá»Ÿ thÃ nh 1 Web Application ( "turns your application to a web application" )

### Sá»­ dá»¥ng Webview nhÆ° tháº¿ nÃ o?

- **Äá»ƒ sá»­ dá»¥ng Webview ta cÃ³ 2 trÆ°á»ng há»£p cÃ³ thá»ƒ cáº§n Ä‘áº¿n:**
  - Náº¡p Website tá»« 1 HTML trong project
  - Náº¡p Website tá»« 1 Ä‘Æ°á»ng dáº«n cá»§a website Ä‘Ã³.

## iOS

### TÃ¬m Hiá»ƒu Vá» WebView Trong iOS

**iOS** há»— trá»£ **WebView** thÃ´ng qua hai lá»›p chÃ­nh trong framework **WebKit**:

- **UIWebView:** ÄÆ°á»£c sá»­ dá»¥ng trong cÃ¡c phiÃªn báº£n iOS cÅ© hÆ¡n (trÆ°á»›c iOS 8). Tuy nhiÃªn, UIWebView Ä‘Ã£ bá»‹ Apple deprecate vÃ  khÃ´ng nÃªn sá»­ dá»¥ng trong cÃ¡c á»©ng dá»¥ng má»›i.

- **WKWebView:** ÄÆ°á»£c giá»›i thiá»‡u tá»« iOS 8 trá»Ÿ lÃªn, lÃ  phiÃªn báº£n cáº£i tiáº¿n cá»§a UIWebView. WKWebView cÃ³ hiá»‡u suáº¥t cao hÆ¡n vÃ  há»— trá»£ nhiá»u tÃ­nh nÄƒng hiá»‡n Ä‘áº¡i nhÆ°:
  - TÄƒng tá»‘c pháº§n cá»©ng khi hiá»ƒn thá»‹ ná»™i dung web.
  - TÆ°Æ¡ng tÃ¡c tá»‘t hÆ¡n vá»›i JavaScript thÃ´ng qua WKScriptMessageHandler.
  - Há»— trá»£ táº£i cÃ¡c trang web tá»« URL hoáº·c chuá»—i HTML.
  - TÃ­nh nÄƒng báº£o máº­t vÃ  quáº£n lÃ½ bá»™ nhá»› tá»‘t hÆ¡n so vá»›i UIWebView.

#### 1.1 **Náº¡p Website tá»« má»™t file HTML trong á»©ng dá»¥ng**

Äáº§u tiÃªn, báº¡n cáº§n thÃªm má»™t `WKWebView` vÃ o giao diá»‡n cá»§a á»©ng dá»¥ng báº±ng cÃ¡ch táº¡o nÃ³ trong code hoáº·c thÃªm vÃ o storyboard.

VÃ­ dá»¥ táº¡o `WKWebView` trong code:

```swift
import UIKit
import WebKit

class ViewController: UIViewController {
    var webView: WKWebView!

    override func viewDidLoad() {
        super.viewDidLoad()

        webView = WKWebView(frame: self.view.frame)
        self.view.addSubview(webView)

        if let filePath = Bundle.main.path(forResource: "yourfile", ofType: "html") {
            let url = URL(fileURLWithPath: filePath)
            webView.loadFileURL(url, allowingReadAccessTo: url)
        }
    }
}
```

#### 1.2 **Náº¡p Website tá»« má»™t URL**

Äá»ƒ náº¡p má»™t trang web tá»« URL, báº¡n chá»‰ cáº§n gá»i phÆ°Æ¡ng thá»©c `load()` cá»§a `WKWebView` vá»›i má»™t Ä‘á»‘i tÆ°á»£ng `URLRequest`.

VÃ­ dá»¥:

```swift
let url = URL(string: "https://www.apple.com")!
let request = URLRequest(url: url)
webView.load(request)
```

Náº¿u trang web cáº§n cháº¡y JavaScript, báº¡n pháº£i báº­t JavaScript báº±ng cÃ¡ch cáº¥u hÃ¬nh `WKWebViewConfiguration`:

```swift
let config = WKWebViewConfiguration()
config.preferences.javaScriptEnabled = true
webView = WKWebView(frame: self.view.frame, configuration: config)
```

### 2: **Xá»­ lÃ½ sá»± kiá»‡n trong WKWebView**

Sau khi báº¡n Ä‘Ã£ hiá»ƒn thá»‹ thÃ nh cÃ´ng má»™t trang web trong á»©ng dá»¥ng, báº¡n cÃ³ thá»ƒ muá»‘n xá»­ lÃ½ cÃ¡c sá»± kiá»‡n khi ngÆ°á»i dÃ¹ng tÆ°Æ¡ng tÃ¡c vá»›i web (vÃ­ dá»¥: nháº¥n vÃ o má»™t Ä‘Æ°á»ng dáº«n, táº£i trang má»›i, hoáº·c xá»­ lÃ½ lá»—i khi táº£i). Äá»ƒ lÃ m Ä‘iá»u nÃ y, báº¡n cáº§n sá»­ dá»¥ng `WKNavigationDelegate`.

VÃ­ dá»¥:

```swift
extension ViewController: WKNavigationDelegate {
    func webView(_ webView: WKWebView, didStartProvisionalNavigation navigation: WKNavigation!) {
        print("Báº¯t Ä‘áº§u táº£i trang")
    }

    func webView(_ webView: WKWebView, didFinish navigation: WKNavigation!) {
        print("HoÃ n táº¥t táº£i trang")
    }

    func webView(_ webView: WKWebView, didFail navigation: WKNavigation!, withError error: Error) {
        print("Lá»—i khi táº£i trang: \(error.localizedDescription)")
    }
}
```

Äá»«ng quÃªn gÃ¡n delegate cho `WKWebView`:

```swift
webView.navigationDelegate = self
```

### 3: **Xá»­ lÃ½ BackStack**

Khi ngÆ°á»i dÃ¹ng nháº¥n nÃºt back trong á»©ng dá»¥ng, báº¡n cÃ³ thá»ƒ muá»‘n quay láº¡i trang web trÆ°á»›c Ä‘Ã³ thay vÃ¬ thoÃ¡t á»©ng dá»¥ng. Äá»ƒ lÃ m Ä‘iá»u nÃ y, báº¡n cáº§n kiá»ƒm tra stack cá»§a `WKWebView` vÃ  xá»­ lÃ½ thá»§ cÃ´ng trong `viewWillDisappear` hoáº·c khi ngÆ°á»i dÃ¹ng nháº¥n nÃºt back.

VÃ­ dá»¥:

```swift
override func viewWillDisappear(_ animated: Bool) {
    if webView.canGoBack {
        webView.goBack()
    } else {
        super.viewWillDisappear(animated)
    }
}
```

## Android

### 1.1 Náº¡p Website tá»« 1 file HTML

Äáº§u tiÃªn, ta sáº½ cáº§n thiáº¿t láº­p 1 Webview trong layout cá»§a báº¡n báº±ng 1 tháº» Webview trong file

![image](https://github.com/user-attachments/assets/f63aff9b-2b75-4824-b119-4708d5b6cb44)

**MainActivity.xml:**

![image](https://github.com/user-attachments/assets/4939c868-1d77-48e7-b93a-5c197593ce5a)

Tiáº¿p Ä‘áº¿n ta cáº§n thiáº¿t láº­p 1 file **yourfile.html** vá»›i Ä‘á»‹nh dáº¡ng HTML trong project cá»§a báº¡n á»Ÿ thÆ° má»¥c **assets**.

![image](https://github.com/user-attachments/assets/c51ed90f-a18e-4068-b782-4a70d14dfa2c)

VÃ  sau Ä‘Ã³ lÃ  thá»±c hiá»‡n load file HTML Ä‘Ã£ Ä‘á»‹nh nghÄ©a trong **MainActivity.kt** sá»­ dá»¥ng phÆ°Æ¡ng thá»©c **loadUrl()** cá»§a WebView.

![image](https://github.com/user-attachments/assets/8633c92e-43d4-439d-98d9-5da77110f5a4)

### 1.2 Náº¡p Website tá»« 1 Ä‘Æ°á»ng dáº«n Ä‘áº¿n website.

Vá»›i trÆ°á»ng há»£p load website tá»« 1 Ä‘Æ°á»ng dáº«n cá»§a web thÃ¬ Ä‘áº§u tiÃªn báº¡n cáº§n cáº¥p quyá»n Internet cho á»©ng dá»¥ng.

![image](https://github.com/user-attachments/assets/f365a619-c5d2-46b7-8ac6-31f3746775ce)

Sau Ä‘Ã³ tiáº¿n hÃ nh truyá»n Url cá»§a Web vÃ o phÆ°Æ¡ng thá»©c **loadUrl()** cá»§a Webview. Thiáº¿t láº­p webview trong file xml báº¡n váº«n sáº½ lÃ m nhÆ° vá»›i 2.1.

![image](https://github.com/user-attachments/assets/7507616a-03b4-4369-89be-77dd7e499962)

TrÆ°á»ng há»£p website cÃ³ sá»­ dá»¥ng Javascripts thÃ¬ báº¡n cÃ³ thá»ƒ thÃªm dÃ²ng lá»‡nh bÃªn dÆ°á»›i

![image](https://github.com/user-attachments/assets/2784c376-c48f-4aae-ab1b-d42ac36fb647)

Tiáº¿n hÃ nh cháº¡y á»©ng dá»¥ng vÃ  báº¡n sáº½ hiá»ƒn thá»‹ Ä‘Æ°á»£c web trong á»©ng dá»¥ng cá»§a báº¡n

![image](https://github.com/user-attachments/assets/64cab848-11c4-4c61-bb6b-2d90b2a5f547)

### 2. Xá»­ lÃ½ sá»± kiá»‡n trong Webview.

Váº­y lÃ  báº¡n Ä‘Ã£ thÃ nh cÃ´ng load Ä‘Æ°á»£c 1 website lÃªn á»©ng dá»¥ng cá»§a mÃ¬nh rá»“i ğŸ’¯

Tuy nhiÃªn, sau khi website Ä‘Æ°á»£c hiá»ƒn thá»‹ trong app thÃ¬ lÃ m tháº¿ nÃ o láº­p trÃ¬nh viÃªn cÃ³ thá»ƒ xá»­ lÃ­ Ä‘Æ°á»£c sá»± kiá»‡n khi ngÆ°á»i dÃ¹ng sá»­ dá»¥ng website Ä‘Ã³? VÃ­ dá»¥ nhÆ° khi há» nháº¥n vÃ o 1 Ä‘Æ°á»ng dáº«n hay khi há» nháº¥n back trÃªn web. Láº­p trÃ¬nh viÃªn sáº½ láº¯ng nghe vÃ  xá»­ lÃ½ sá»± kiá»‡n Ä‘Ã³ nhÆ° tháº¿ nÃ o ?

Äá»ƒ giáº£i quyáº¿t váº¥n Ä‘á» nÃ y thÃ¬ Webview cÃ³ 1 giáº£i phÃ¡p Ä‘Æ°á»£c gá»i lÃ  \***\*WebViewClient\*\***.

**WebViewClient** Ä‘Æ°á»£c hiá»ƒu lÃ  nÆ¡i xá»­ lÃ½ khi ngÆ°á»i dÃ¹ng tÆ°Æ¡ng tÃ¡c vá»›i website Ä‘Æ°á»£c load lÃªn trong á»©ng dá»¥ng cá»§a báº¡n. BÃ¬nh thÆ°á»ng náº¿u khÃ´ng sá»­ dá»¥ng **WebViewClient** thÃ¬ khi báº¡n tÆ°Æ¡ng tÃ¡c vá»›i web(nháº¥n vÃ o 1 Ä‘Æ°á»ng dáº«n trong web, ...) thÃ¬ Ä‘Æ°á»ng dáº«n mÃ  báº¡n nháº¥n sáº½ Ä‘Æ°á»£c load lÃªn bá»Ÿi trÃ¬nh duyá»‡t máº·c Ä‘á»‹nh cá»§a Ä‘iá»‡n thoáº¡i chá»© khÃ´ng pháº£i bá»Ÿi Webview ná»¯a. LÃºc nÃ y sáº½ ráº¥t khÃ³ Ä‘á»ƒ kiá»ƒm soÃ¡t cÃ¡c tÆ°Æ¡ng tÃ¡c vá»›i website Ä‘Ã³.

Vá»›i Kotlin báº¡n chá»‰ cáº§n setup báº±ng hÃ m webViewClient() sau Ä‘Ã³ truyá»n 1 object WebviewClient vÃ  tiáº¿n hÃ nh ghi Ä‘Ã¨ phÆ°Æ¡ng thá»©c shouldOverrideUrlLoading() Ä‘á»ƒ xá»­ lÃ½ má»—i khi ngÆ°á»i dÃ¹ng nháº¥n vÃ o báº¥t ká»³ link nÃ o trÃªn website Ä‘á»“ng thá»i má»Ÿ link Ä‘Ã³ vá»›i Webview chá»© khÃ´ng pháº£i sá»­ dá»¥ng trÃ¬nh duyá»‡t cá»§a thiáº¿t bá»‹.

HÃ m **shouldOverrideUrlLoading()** sáº½ cháº¡y ngay sau khi hÃ m **loadUrl()** Ä‘Æ°á»£c thá»±c thi. Táº¡i Ä‘Ã¢y báº¡n cÃ³ thá»ƒ kiá»ƒm tra Url Ä‘Æ°á»£c click vÃ  cÃ³ thá»ƒ ghi Ä‘Ã¨ Url truyá»n vÃ o

![image](https://github.com/user-attachments/assets/42b4cfe3-1ab8-42eb-ba8a-672758fc7e67)

### 3. CÃ¡c Callback Quan Trá»ng Khi Sá»­ Dá»¥ng WebView

1. **`onPageStarted()`**  
   HÃ m nÃ y sáº½ Ä‘Æ°á»£c gá»i khi trang web **báº¯t Ä‘áº§u load**, vÃ  nÃ³ Ä‘Æ°á»£c gá»i **sau khi hÃ m `loadUrl()`** Ä‘Æ°á»£c thá»±c thi.

2. **`onPageCommitVisible()`**  
   HÃ m nÃ y sáº½ Ä‘Æ°á»£c gá»i khi ná»™i dung cá»§a trang web **báº¯t Ä‘áº§u hiá»ƒn thá»‹ lÃªn giao diá»‡n** ngÆ°á»i dÃ¹ng.

3. **`onPageFinished()`**  
   HÃ m nÃ y sáº½ Ä‘Æ°á»£c gá»i khi trang web Ä‘Ã£ **hoÃ n táº¥t viá»‡c load** vÃ  **hiá»ƒn thá»‹ Ä‘áº§y Ä‘á»§** trÃªn mÃ n hÃ¬nh.

4. **`onReceivedError()`**  
   HÃ m nÃ y sáº½ Ä‘Æ°á»£c gá»i khi cÃ³ lá»—i xáº£y ra trong quÃ¡ trÃ¬nh **load trang web**.
