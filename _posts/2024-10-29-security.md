---
layout: post
title: "BẢO MẬT NHẬP MÔN"
categories: misc
---

* [GIAO THỨC HTTP “BẢO MẬT” ĐẾN MỨC NÀO?](#window)
* [LỖ HỔNG BẢO MẬT XSS NGUY HIỂM ĐẾN MỨC NÀO?](#introduction)
* [LƯU TRỮ COOKIE – TƯỞNG KHÔNG HẠI AI NGỜ HẠI KHÔNG TƯỞNG](#javascript)
* [Truy cập DOM](#accessing)
* [Node](#node)
* [Kết](#inconclution)

## GIAO THỨC HTTP “BẢO MẬT” ĐẾN MỨC NÀO? {#window}
HTTP là một giao thức dùng để truyền nhận dữ liệu. Nhược điểm của HTTP là dữ liệu được truyền dưới dạng plain text, không hề được mã hoá hay bảo mật. Điều này dẫn đến việc hacker có thể dễ dàng nghe lén, chôm chỉa và chỉnh sửa dữ liệu. Người ta gọi kiểu tấn công này là Man-in-the-middle attack, viết tắt là MITM.

**Cách phòng chống**
- Dùng HTTPS + SSL Certificate
- Sử dụng đăng nhập qua Google hoặc Facebook ở đây nó sẽ ko để lộ user và password, so với nếu dùng chỉ dùng http khẳ năng lộ user và password khi login sẽ rất cao. Nhưng vẫn có khả năng sẽ lộ cookie.

**Lưu ý**
- Cần hết sức cẩn thận khi dùng wifi chùa/wifi công cộng vì hacker có thể dùng một số phần mềm như Fiddler đọc lén cookie cũng như thông tin nhạy cảm.


## LỖ HỔNG BẢO MẬT XSS NGUY HIỂM ĐẾN MỨC NÀO? {#introduction}

XSS (Cross Site Scripting) là một lỗi bảo mật cho phép hacker nhúng mã độc (javascript) vào
một trang web khác. Hacker có thể lợi dụng mã độc này để deface trang web, cài keylog,
chiếm quyền điều khiển của người dùng, dụ dỗ người dùng tải virus về máy.

**Những dạng XSS**
- **1. Persistent XSS**
     -  Kẻ tấn công chèn mã độc (thường là JavaScript) vào trang web, và mã này sẽ được lưu trữ lại trên data base của server.
     - Khi người dùng khác truy cập vào trang web và tải nội dung chứa mã độc, mã này sẽ được thực thi trên trình duyệt của họ.

     - **Ví dụ**
        - Trên ứng dụng nào đó, khi bạn post một comment vào topic, server sẽ lưu comment bạn post
        và hiển thị dưới dạng HTML.
        - ```typescript
        import { Component } from '@angular/core';
        @Component({
          selector: 'app-comment',
          template: `
            <div *ngFor="let comment of comments">
              <div [innerHTML]="comment"></div>
            </div>
            <textarea [(ngModel)]="newComment" placeholder="Write a comment..."></textarea>
            <button (click)="addComment()">Add Comment</button>
          `,
          styleUrls: ['./comment.component.css']
        })
        export class CommentComponent {
          comments: string[] = [];
          newComment: string = '';

          addComment(): void {
            if (this.newComment.trim()) {
              this.comments.push(this.newComment); // Không có lọc hay xử lý ở đây
              this.newComment = ''; // Xóa nội dung comment sau khi thêm
            }
          }
        }    
      ```
        - Trường hợp newComment nếu nhập đầu vào là một mã độc vào bình luận 
        ```typescript <script>alert('XSS!');</script>)``` Trình duyệt sẽ chạy đoạn script này, hiển thị cửa sổ alert lên. Hacker đã chèn được mã độc vào ứng dụng, thực hiện tấn công XSS thành công. Bất kì ai thấy comment này đều bị dính mã độc này, do đó kiểu tấn công này có tầm ảnh hưởng lớn, khá nguy hiểm.

- **2. Reflected XSS**
    - Với cách tấn công này, hacker chèn mã độc vào URL dưới dạng query string. Khi người dùng
      ngáo ngơ nhấp vào URL này, trang web sẽ đọc query string, render mã độc vào HTML và người
      dùng “dính bẫy”.

    - **Ví dụ**  
      - Hacker gưi 1 đường link giả vào mail người dùng.Nội dung đường link: ```http://facebook.com?q=<script>deleteAccount();</script> ```. Khi các 
      người dùng click link này, họ sẽ vào trang facebook. Sau đó server sẽ render ```<script>deleteAccount();
        </script>```, gọi hàm deleteAccount trong JavaScript để xoá account của họ.
        Tầm ảnh hưởng của ReflectedXSS không rộng bằng Persistance XSS, nhưng mức độ nguy hiểm
        là tương đương. Hacker thường gửi link có mã độc qua email, tin nhắn, ... và dụ dỗ người
        dùng click vào. Do đó các bạn nên cẩn thận với những đường link ko đáng tin nhé.

**Cách phòng tránh**
- **1. Encoding**
    - Không được tin tưởng bất kì thứ gì người dùng nhập vào!! Hãy sử dụng hàm encode có sẵn
    trong ngôn ngữ/framework để **chuyển các kí tự < > thành &lt; %gt;**.
- **2. Validation/Sanitize**
    - Validation: loại bỏ hoàn toàn các kí tự khả nghi trong input của
người dùng, hoặc thông báo lỗi nếu trong input có các kí tự này.
    - Ngoài ra, nếu muốn cho phép người dùng nhập vào HTML, hãy sử dụng các thư viện sanitize.
Các thư viện này sẽ lọc các thẻ HTML, CSS, JS nguy hiểm để chống XSS. Người dùng vẫn có thể
sử dụng các thẻ <p>, <span>, <ul> để trình bày văn bản.
    - Nếu bạn dùng framework Angular có thể sử dụng **DomSanitizer**
      - **DomSanitizer**: Dùng để đảm bảo rằng dữ liệu HTML đầu vào từ người dùng không chứa mã độc.
      - **bypassSecurityTrustHtml**: Chuyển đổi dữ liệu HTML đầu vào từ người dùng thành SafeHtml trước khi hiển thị, đảm bảo rằng nó không thể chứa các mã độc như JavaScript.

## Javascript và DOM {#javascript}
 >> Trong Browser thì sẽ bao gồm
 >> 1. DOM
 >> 2. JavaScript Engine (V8)

- DOM là một đối tượng khác hoàn toàn với Javascript

- Browser tạo DOM để render ra trang web

- DOM không tồn tại trong Javascript engine 

- Để Javascript có thể truy cập đến DOM thì ta cần có DOM API 

## Truy cập DOM {#accessing}
**Thuộc tính:** 
- **id:**
  Là duy nhất cho mỗi phần tử nên thường được dùng để truy xuất DOM trực tiếp và nhanh chóng.
- **className:** 
  Dùng để truy xuất trực tiếp như id, nhưng 1 className có thể dùng cho nhiều phần tử.
- **tagName:** 
  Tên thẻ HTML.
- **innerHTML:** 
  Trả về mã HTML bên trong phần tử hiện tại. Đoạn mã HTML này là chuỗi kí tự chứa tất cả phần tử bên trong, bao gồm các nút phần tử và nút văn bản.
- **outerHTML:** 
  Trả về mã HTML của phần tử hiện tại. Nói cách khác, outerHTML = tagName + innerHTML.
- **textContent:** 
  Trả về 1 chuỗi kí tự chứa nội dung của tất cả nút văn bản bên trong phần tử hiện tại.
- **attributes:** 
  Tập các thuộc tính như id, name, class, href, title…
- **style:** 
  Tập các định dạng của phần tử hiện tại
- **value:** 
  Lấy giá trị của thành phần được chọn thành một biến.

**Phương thức:**
- **getElementById(id):** 
  Tham chiếu đến 1 nút duy nhất có thuộc tính id giống với id cần tìm.
- **getElementsByTagName(tagname):** 
  Tham chiếu đến tất cả các nút có thuộc tính tagName giống với tên thẻ cần tìm, hay hiểu đơn giản hơn là tìm tất cả các phần tử DOM mang thẻ HTML cùng loại. Nếu muốn truy xuất đến toàn bộ thẻ trong tài liệu HTML thì hãy sử dụng document.getElementsByTagName('*').
- **getElementsByName(name):** 
  Tham chiếu đến tất cả các nút có thuộc tính name cần tìm.
- **getAttribute(attributeName):** 
  Lấy giá trị của thuộc tính.
- **setAttribute(attributeName, value):** 
  Sửa giá trị của thuộc tính.
- **appendChild(node):** 
  Thêm 1 nút con vào nút hiện tại.
- **removeChild(node):** 
  Xóa 1 nút con khỏi nút hiện tại.

## NODE {#node}
- Tất cả các phần tử trong DOM đều được định nghĩa là các nút (node). Có nhiều loại nút khác nhau, nhưng có ba loại chính mà chúng ta thường làm việc:
    - Nút phần tử (Element nodes)
    - Nút văn bản (Text nodes)
    - Nút chú thích (Comment nodes)

```html
<!DOCTYPE html>
<html>

  <head>
    <title>Learning About Nodes</title>
  </head>

  <body>
    <h1>An element node</h1>
    <!-- a comment node -->
    A text node.
  </body>

</html> 
```

## Kết {#inconclution}
- Ngoài những thông tin ở trên thì ở đây mình có một một khái niệm nữa muốn chia sẻ đó là BOM (Browser Object Model) cho phép Javascript có thể thao tác được với Browser 
  - navigator 
  - location
  - screen 
  - history 

- Tài liệu tham khảo 
  - [Understanding the DOM Tree and Nodes](https://www.digitalocean.com/community/tutorials/understanding-the-dom-tree-and-nodes)
  - [Understanding Document Object Model (DOM) in Details](https://www.hongkiat.com/blog/understanding-document-object-model/#google_vignette)

