---
layout: post
title: "Redis Pub/Sub"
categories: architecture
---

- NÃ³ hoáº¡t Ä‘á»™ng á»Ÿ táº§ng BE, thÆ°á»ng Ä‘Æ°á»£c sá»­ dá»¥ng á»Ÿ nhá»¯ng há»‡ thÃ´ng `Micro Server` giÃºp truyá»n dá»¯ liá»‡u giá»¯a cÃ¡c service.
- **NhÆ°á»£c Ä‘iá»ƒm:** khÃ´ng giao tiáº¿p Ä‘Æ°á»£c `frontend end`, náº¿u build má»™t há»‡ thá»‘ng chat thÃ¬ váº«n cáº§n thÃªm `socket.io`.

```
      [Client 1]      [Client 2]       [Client 3]
         â”‚                â”‚                â”‚
         â–¼                â–¼                â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ WebSocket  â”‚   â”‚ WebSocket  â”‚   â”‚ WebSocket  â”‚
  â”‚   Server 1 â”‚   â”‚   Server 2 â”‚   â”‚   Server 3 â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                â”‚                â”‚
         â””â”€â”€â”€â”€â”€â”€â”€ Redis Pub/Sub Cluster â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                â”‚
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚        Backend API           â”‚
                 â”‚(Microservices, Database, ...)â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## **Chat Real-Time**

1. **NgÆ°á»i dÃ¹ng A** gá»­i tin nháº¯n Ä‘áº¿n **WebSocket Server 1**.
2. **WebSocket Server 1** _publish_ tin nháº¯n Ä‘Ã³ lÃªn **Redis Pub/Sub**.
3. Táº¥t cáº£ **WebSocket Servers** nháº­n Ä‘Æ°á»£c tin nháº¯n tá»« **Redis**.
4. **WebSocket Server 2** (nÆ¡i **NgÆ°á»i dÃ¹ng B** Ä‘ang káº¿t ná»‘i) ngay láº­p tá»©c gá»­i tin nháº¯n tá»›i **NgÆ°á»i dÃ¹ng B**.

## **VÃ­ dá»¥**

```
      [Client Äáº·t HÃ ng]
             â”‚
             â–¼
    ğŸ›’ Order Service (Publish sá»± kiá»‡n 'order.created')
             â”‚
             â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Redis Pub/Sub â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                                                     â”‚
  ğŸ“¦ Inventory Service (Subscribe)      ğŸ’³ Payment Service (Subscribe)
  - Giáº£m sá»‘ lÆ°á»£ng tá»“n kho               - XÃ¡c nháº­n thanh toÃ¡n
     â”‚                                                     â”‚
     â–¼                                                     â–¼
  ğŸšš Shipping Service (Subscribe)       ğŸ“¢ Notification Service (Subscribe)
  - Táº¡o mÃ£ váº­n Ä‘Æ¡n                      - Gá»­i thÃ´ng bÃ¡o SMS, Email, WebSocket
      [Client Äáº·t HÃ ng]
             â”‚
             â–¼
    ğŸ›’ Order Service (Publish sá»± kiá»‡n 'order.created')
             â”‚
             â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Redis Pub/Sub â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                                                     â”‚
  ğŸ“¦ Inventory Service (Subscribe)      ğŸ’³ Payment Service (Subscribe)
  - Giáº£m sá»‘ lÆ°á»£ng tá»“n kho               - XÃ¡c nháº­n thanh toÃ¡n
     â”‚                                                     â”‚
     â–¼                                                     â–¼
  ğŸšš Shipping Service (Subscribe)       ğŸ“¢ Notification Service (Subscribe)
  - Táº¡o mÃ£ váº­n Ä‘Æ¡n                      - Gá»­i thÃ´ng bÃ¡o SMS, Email, WebSocket
```

- **KhÃ¡ch Äáº·t HÃ ng:** NgÆ°á»i dÃ¹ng nháº¥n â€œMua ngayâ€ vÃ  gá»­i yÃªu cáº§u tá»›i **Order Service**.
- **Publish Sá»± Kiá»‡n:** **Order Service** gá»­i sá»± kiá»‡n `'order.created'` lÃªn **Redis Pub/Sub**.
- **CÃ¡c Service Nghe (Subscribe):**
  - ğŸ“¦ **Inventory Service:** Nháº­n sá»± kiá»‡n, trá»« sá»‘ lÆ°á»£ng hÃ ng tá»“n.
  - ğŸ’³ **Payment Service:** Kiá»ƒm tra vÃ  xÃ¡c nháº­n thanh toÃ¡n.
  - ğŸšš **Shipping Service:** Táº¡o Ä‘Æ¡n giao hÃ ng, sinh mÃ£ váº­n Ä‘Æ¡n.
  - ğŸ“¢ **Notification Service:** Äáº©y thÃ´ng bÃ¡o qua WebSocket, email, SMS.
- **Thá»i Gian Thá»±c:** NgÆ°á»i dÃ¹ng tháº¥y ngay tráº¡ng thÃ¡i â€œÄÃ£ xÃ¡c nháº­n Ä‘Æ¡n hÃ ngâ€ trÃªn á»©ng dá»¥ng qua WebSocket.
